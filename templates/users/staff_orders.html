<head>
	<script src="https://cdn.jsdelivr.net/npm/apexcharts@3.46.0/dist/apexcharts.min.js"></script>
</head>
{% extends "base.html" %}
{% load humanize %}

{% block extrahead %}
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
	<!-- Statistics Overview -->
	<div class="mb-8">
		<h2 class="text-2xl font-bold mb-6">Revenue Statistics</h2>
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
			<!-- Total Orders -->
			<div class="bg-white rounded-lg shadow p-6">
				<div class="text-sm font-medium text-gray-500">Total Orders</div>
				<div class="mt-2 text-3xl font-bold text-gray-900">{{ total_orders|floatformat:"0" }}</div>
			</div>
			
			<!-- Total Revenue -->
			<div class="bg-white rounded-lg shadow p-6">
				<div class="text-sm font-medium text-gray-500">Total Revenue</div>
				<div class="mt-2 text-3xl font-bold text-gray-900">{{ total_revenue|floatformat:"0"|intcomma }} VND</div>
			</div>
			
			<!-- Average Order Value -->
			<div class="bg-white rounded-lg shadow p-6">
				<div class="text-sm font-medium text-gray-500">Average Order Value</div>
				<div class="mt-2 text-3xl font-bold text-blue-600">{{ avg_order_value|floatformat:"0"|intcomma }} VND</div>
			</div>
			
			<!-- Delivered Orders -->
			<div class="bg-white rounded-lg shadow p-6">
				<div class="text-sm font-medium text-gray-500">Delivered Orders</div>
				<div class="mt-2 text-3xl font-bold text-green-600">{{ total_delivered|floatformat:"0" }}</div>
			</div>
		</div>
	</div>

	<!-- Revenue Chart -->
	<div class="w-full bg-white rounded-lg shadow-sm dark:bg-gray-800 p-4 md:p-6 mb-8">
		<div class="flex justify-between">
			<div>
				<h5 class="leading-none text-3xl font-bold text-gray-900 dark:text-white pb-2">32.4k</h5>
				<p class="text-base font-normal text-gray-500 dark:text-gray-400">Users this week</p>
			</div>
			<div
				class="flex items-center px-2.5 py-0.5 text-base font-semibold text-green-500 dark:text-green-500 text-center">
				12%
				<svg class="w-3 h-3 ms-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 14">
					<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13V1m0 0L1 5m4-4 4 4"/>
				</svg>
			</div>
		</div>
		<div id="area-chart"></div>
	</div>
	<!-- Orders Table -->
	<div class="bg-white rounded-lg shadow overflow-hidden">
		<div class="px-6 py-4 border-b border-gray-200">
			<h2 class="text-xl font-semibold">All Orders</h2>
		</div>
		<div class="overflow-x-auto">
			<table class="min-w-full divide-y divide-gray-200">
				<thead class="bg-gray-50">
					<tr>
						<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Order ID</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Items</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Total</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
						<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
					</tr>
				</thead>
				<tbody class="bg-white divide-y divide-gray-200">
					{% for order in orders %}
					<tr>
						<td class="px-6 py-4 whitespace-nowrap">
							<div class="text-sm font-medium text-gray-900">#{{ order.id }}</div>
						</td>
						<td class="px-6 py-4 whitespace-nowrap">
							<div class="text-sm text-gray-900">{{ order.user.get_full_name }}</div>
							<div class="text-sm text-gray-500">{{ order.user.email }}</div>
						</td>
						<td class="px-6 py-4 whitespace-nowrap">
							<div class="text-sm text-gray-900">{{ order.created_at|date:"F j, Y H:i" }}</div>
						</td>
						<td class="px-6 py-4">
							<div class="text-sm text-gray-900">
								{% for item in order.orderitem_set.all %}
									<div>{{ item.quantity }}x {{ item.menu_item.name }}</div>
								{% endfor %}
							</div>
						</td>
						<td class="px-6 py-4 whitespace-nowrap">
							<div class="text-sm font-medium text-gray-900">{{ order.total_amount|intcomma }} VND</div>
						</td>
						<td class="px-6 py-4 whitespace-nowrap">
							<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
								{% if order.status == 'PENDING' %}bg-yellow-100 text-yellow-800
								{% elif order.status == 'PROCESSING' %}bg-blue-100 text-blue-800
								{% elif order.status == 'DELIVERED' %}bg-green-100 text-green-800
								{% elif order.status == 'CANCELLED' %}bg-red-100 text-red-800{% endif %}">
								{{ order.get_status_display }}
							</span>
						</td>
						<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
							<a href="{% url 'order-detail' order.id %}" class="text-blue-600 hover:text-blue-900">View Details</a>
						</td>
					</tr>
					{% empty %}
					<tr>
						<td colspan="7" class="px-6 py-4 text-center text-gray-500">
							No orders found
						</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
	const options = {
		chart: {
			height: "100%",
			maxWidth: "100%",
			type: "area",
			fontFamily: "Inter, sans-serif",
			dropShadow: {
				enabled: false,
			},
			toolbar: {
				show: false,
			},
		},
		tooltip: {
			enabled: true,
			x: {
				show: false,
			},
		},
		fill: {
			type: "gradient",
			gradient: {
				opacityFrom: 0.55,
				opacityTo: 0,
				shade: "#1C64F2",
				gradientToColors: ["#1C64F2"],
			},
		},
		dataLabels: {
			enabled: false,
		},
		stroke: {
			width: 6,
		},
		grid: {
			show: false,
			strokeDashArray: 4,
			padding: {
				left: 2,
				right: 2,
				top: 0
			},
		},
		series: [
			{
				name: "New users",
				data: [6500, 6418, 6456, 6526, 6356, 6456],
				color: "#1A56DB",
			},
		],
		xaxis: {
			categories: ['01 February', '02 February', '03 February', '04 February', '05 February', '06 February', '07 February'],
			labels: {
				show: false,
			},
			axisBorder: {
				show: false,
			},
			axisTicks: {
				show: false,
			},
		},
		yaxis: {
			show: false,
		},
	}
	const chart = new ApexCharts(document.getElementById("area-chart"), options);
	chart.render();
});
</script>
{% endblock %} 